const mainHeader=document.querySelector(".main-header"),specificPageContainer=document.querySelector(".spec-items"),mainPageContainer=document.querySelector(".spec-container"),clearBtn=document.querySelector(".order-deleteAll-button"),addedLabel=document.querySelector(".added"),ifOrderIsEmpty=document.querySelector(".order-empty");addedLabel&&addedLabel.addEventListener("animationend",()=>{addedLabel.classList.remove("animate")}),clearBtn&&clearBtn.addEventListener("click",clearOrder);const navBarList=document.querySelector(".navbar-list"),navBarIcon=document.querySelector(".navbar-icon");navBarIcon.addEventListener("click",()=>{navBarIcon.classList.toggle("opened"),navBarList.classList.toggle("opened")});const navBarFolding=document.querySelector(".navbar-list--folding"),navBarFolded=document.querySelector(".navbar-list--folded");navBarFolding.addEventListener("click",()=>{navBarFolded.classList.toggle("opened")}),async function(){if(mainHeader){let e=await fetch("./dist/json/items.json"),t=await e.json();if("italian specialities"===mainHeader.textContent.toLowerCase())for(item of t)if("1111"===item.id||"1112"===item.id||"1113"===item.id||"1114"===item.id){let e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("h4"),n=document.createElement("p"),i=document.createElement("h6"),d=document.createElement("img");t.appendChild(a),t.appendChild(n),t.appendChild(i),e.appendChild(t),e.appendChild(d),e.classList.add("spec-item","col-sm-12","row","col-xl-6"),d.classList.add("spec-item--image","col-sm-6"),t.classList.add("spec-item--info","col-sm-6"),a.textContent=item.name,n.textContent=item.aboutMini,i.textContent="Price: "+item.price+"$",d.src="./dist/image/"+item.imagePath,d.alt=item.name+" image",createOrderButton(item.id,t),mainPageContainer.appendChild(e)}if("main dishes"===mainHeader.textContent.toLowerCase()||"salad"===mainHeader.textContent.toLowerCase()||"drinks"===mainHeader.textContent.toLowerCase()){let e,a=1;for(item of(e=mainHeader.textContent.includes(" ")?mainHeader.textContent.slice(0,mainHeader.textContent.indexOf(" ")):mainHeader.textContent,t))if(item.type===e.toLowerCase()){++a;let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("h4"),i=document.createElement("p"),d=document.createElement("h6"),l=document.createElement("img");e.classList.add("spec-item","col-md-12","row"),l.classList.add("spec-item--image-full","col-md-6"),t.classList.add("spec-item--info-full","col-md-6"),t.appendChild(n),t.appendChild(i),t.appendChild(d),a%2==0?(e.appendChild(t),e.appendChild(l)):(e.appendChild(l),e.appendChild(t)),n.textContent=item.name,i.textContent=item.about,d.textContent="Price: "+item.price+"$",l.src="./dist/image/"+item.imagePath,l.alt=item.name,createOrderButton(item.id,t),specificPageContainer.appendChild(e)}a=1}if("your order"===mainHeader.textContent.toLowerCase())if(localStorage.order){let e=orderToObject(localStorage.order);for(let a in e)for(item of t)if(item.id===a){let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("h4"),d=document.createElement("p"),l=document.createElement("h6"),o=document.createElement("img");n.classList.add("spec-item","spec-item-order","col-md-6","col-lg-4","col-xl-3"),o.classList.add("spec-item--image-order","col-md-12"),t.classList.add("spec-item--info-order","col-md-12"),n.appendChild(o),n.appendChild(t),t.appendChild(i),item.aboutMini&&(t.appendChild(d),d.textContent=item.aboutMini),t.appendChild(l),l.classList.add("item-price"),i.textContent=item.name,d.textContent=item.aboutMini,e[a]>1?l.textContent=`${(item.price*e[a]).toFixed(2)}$ in total. ${item.price}$ for each.`:l.textContent=item.price+"$ in total.",o.src="./dist/image/"+item.imagePath,o.alt=item.name,createOrderButton(item.id,t,e[a],l,item.price),specificPageContainer.appendChild(n)}let a=document.createElement("h2");a.classList.add("order-total"),specificPageContainer.appendChild(a),getOrderTotal(),createFormElements(specificPageContainer)}else clearBtn.style.display="none",ifOrderIsEmpty.style.display="block"}}();let total=0;function createFormElements(e){let t=document.createElement("form"),a=document.createElement("label"),n=document.createElement("input"),i=document.createElement("label"),d=document.createElement("input"),l=document.createElement("label"),o=document.createElement("input"),r=document.createElement("button");t.classList.add("order-form","col-12"),t.action="#",t.addEventListener("submit",e=>{e.preventDefault();let t={};t.ids=orderToObject(localStorage.order),t.name=n.value,t.phone=d.value,""!==o.textContent&&(t.email=o.value),t.timestamp=(new Date).toLocaleString(),t.total=total+"$"}),a.setAttribute("for","name"),a.textContent="Your name (2-15 symbols)",n.type="text",n.id="name",n.name="name",n.setAttribute("required",""),n.minLength=2,n.maxLength=15,n.placeholder="Your name 2-15 chars.",i.setAttribute("for","phone"),i.textContent="Your phone number",d.type="tel",d.id="phone",d.name="phone",d.setAttribute("required",""),d.placeholder="+7 (___) ___-____",d.pattern="\\+7\\s\\([0-9]{3}\\)\\s[0-9]{3}-[0-9]{4}",d.dataset.slots="_";const c=d.getAttribute("placeholder"),s=new Set(d.dataset.slots||"_"),m=(g=0,Array.from(c,(e,t)=>s.has(e)?g=t+1:g)),p=[...c].findIndex(e=>s.has(e)),u=new RegExp(d.dataset.accept||"\\d","g"),C=e=>(e=e.match(u)||[],Array.from(c,t=>(e[0]===t||s.has(t))&&e.shift()||t)),h=()=>{const[e,t]=[d.selectionStart,d.selectionEnd].map(e=>(e=C(d.value.slice(0,e)).findIndex(e=>s.has(e)))<0?m[m.length-1]:v?m[e-1]||p:e);d.value=C(d.value).join``,d.setSelectionRange(e,t),v=!1};var g;let v=!1;d.addEventListener("keydown",e=>v="Backspace"===e.key),d.addEventListener("input",h),d.addEventListener("focus",h),d.addEventListener("blur",()=>d.value===c&&(d.value="")),l.setAttribute("for","email"),l.textContent="Your email (Optional)",o.type="email",o.id="email",o.name="email",o.size=30,r.textContent="Make order",r.type="submit",r.value="submit",t.appendChild(a),t.appendChild(n),t.appendChild(i),t.appendChild(d),t.appendChild(l),t.appendChild(o),t.appendChild(r),e.appendChild(t)}function getOrderTotal(){total=0;let e=document.querySelector(".order-total");e.classList.add("col-12"),document.querySelectorAll(".item-price").forEach(e=>{total+=parseFloat(e.textContent.slice(0,e.textContent.indexOf("$")))}),e.textContent=`Total order is ${total.toFixed(2)}$`}function createOrderButton(e,t,a,n,i){let d=document.createElement("div"),l=document.createElement("span"),o=document.createElement("input"),r=document.createElement("span");if(d.classList.add("input"),l.classList.add("input-minus"),r.classList.add("input-plus"),o.classList.add("input-field"),l.textContent="-",l.addEventListener("click",()=>{if("1"!=l.nextElementSibling.value&&(l.nextElementSibling.value=parseInt(l.nextElementSibling.value)-1,a)){let t=orderToObject(localStorage.order);addedLabel&&(addedLabel.classList.add("animate"),addedLabel.style.visibility="visible",addedLabel.textContent="Removed"),t[e]-=1,t[e]>1?n.textContent=`${(i*t[e]).toFixed(2)}$ in total. ${i}$ for each.`:n.textContent=i+"$ in total.",getOrderTotal(),localStorage.order=orderToString(t)}}),r.textContent="+",r.addEventListener("click",()=>{if(r.previousElementSibling.value=parseInt(r.previousElementSibling.value)+1,a){let t=orderToObject(localStorage.order);addedLabel&&(addedLabel.classList.add("animate"),addedLabel.style.visibility="visible",addedLabel.textContent="Added"),t[e]+=1,t[e]>1?n.textContent=`${(i*t[e]).toFixed(2)}$ in total. ${i}$ for each.`:n.textContent=i+"$ in total.",getOrderTotal(),localStorage.order=orderToString(t)}}),o.type="number",o.value=a||1,o.min=1,o.setAttribute("readonly",""),d.appendChild(l),d.appendChild(o),d.appendChild(r),t.appendChild(d),a){let a=document.createElement("button");a.textContent="Delete",a.addEventListener("click",()=>{let t=orderToObject(localStorage.order);delete t[e],localStorage.order=orderToString(t),""===localStorage.order&&clearOrder(),a.parentElement.parentElement.remove(),getOrderTotal()}),t.appendChild(a)}else{let a=document.createElement("button");a.textContent="Add to order",a.classList.add("to-upper"),a.value=e,t.appendChild(a),a.addEventListener("click",()=>{a.classList.add("animate"),addedLabel&&(addedLabel.classList.add("animate"),addedLabel.style.visibility="visible");let e=parseInt(a.previousSibling.children[1].value);localStorage.order?localStorage.order+=e>1?","+a.value+"x"+e:","+a.value:e>1?localStorage.setItem("order",`${a.value}x${e}`):localStorage.setItem("order",""+a.value)}),a.addEventListener("animationend",()=>{a.classList.remove("animate")})}}function orderToString(e){let t="",a=Object.entries(e);return a.forEach(e=>{a.indexOf(e)===a.length-1?t+=e[0]+"x"+e[1]:t+=e[0]+"x"+e[1]+","}),t}function orderToObject(e){let t=e.split(",");t.sort();let a=null,n=0,i={};for(let e=0;e<t.length;e++)t[e].includes(a)?t[e].includes("x")?n+=parseInt(t[e].slice(t[e].indexOf("x")+1)):n++:t[e].includes("x")?(n>0&&(i[a]=n),a=t[e].slice(0,4),n=parseInt(t[e].slice(t[e].indexOf("x")+1))):(n>0&&(i[a]=n),a=t[e],n=1);return n>0&&(i[a]=n),i}function clearOrder(){for(;specificPageContainer.firstChild;)specificPageContainer.firstChild.remove(),localStorage.clear();total=0,clearBtn.style.display="none",ifOrderIsEmpty.style.display="block"}