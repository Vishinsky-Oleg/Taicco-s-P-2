const mainHeader=document.querySelector(".main-header"),specificPageContainer=document.querySelector(".specific-items"),mainPageContainer=document.querySelector(".specialities-container"),clearBtn=document.querySelector(".clear-order");async function obj(){let e=await fetch("./dist/json/items.json"),t=await e.json();if("italian specialities"===mainHeader.textContent.toLowerCase())for(item of t)if("1111"===item.id||"1112"===item.id||"1113"===item.id||"1114"===item.id){let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("h4"),a=document.createElement("p"),r=document.createElement("h6"),o=document.createElement("img");t.appendChild(o),n.appendChild(i),n.appendChild(a),n.appendChild(r),e.appendChild(n),e.appendChild(t),i.textContent=item.name,a.textContent=item.aboutMini,r.textContent=item.price,o.src="./dist/image/"+item.imagePath,o.alt=item.name,createOrderButton(item.id,n),mainPageContainer.appendChild(e)}if("main dishes"===mainHeader.textContent.toLowerCase()||"salad"===mainHeader.textContent.toLowerCase()||"drinks"===mainHeader.textContent.toLowerCase()){let e,n=1;for(item of(e=mainHeader.textContent.includes(" ")?mainHeader.textContent.slice(0,mainHeader.textContent.indexOf(" ")):mainHeader.textContent,t))if(item.type===e.toLowerCase()){++n;let e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),a=document.createElement("h4"),r=document.createElement("p"),o=document.createElement("h6"),l=document.createElement("img");t.appendChild(l),i.appendChild(a),i.appendChild(r),i.appendChild(o),n%2==0?(e.appendChild(i),e.appendChild(t)):(e.appendChild(t),e.appendChild(i)),a.textContent=item.name,r.textContent=item.about,o.textContent=item.price,l.src="./dist/image/"+item.imagePath,l.alt=item.name,createOrderButton(item.id,i),specificPageContainer.appendChild(e)}n=1}if("your order"===mainHeader.textContent.toLowerCase())if(localStorage.order){let e=orderToObject(localStorage.order);for(let n in e)for(item of t)if(item.id===n){let t=document.createElement("div"),i=document.createElement("h4"),a=document.createElement("p"),r=document.createElement("h6"),o=document.createElement("img");t.appendChild(o),t.appendChild(i),t.appendChild(a),t.appendChild(r),i.textContent=item.name,a.textContent=item.aboutMini,e[n]>1?r.textContent=`${item.price*e[n]}$ in total. ${item.price}$ for each.`:r.textContent=item.price+"$ in total.",o.src="./dist/image/"+item.imagePath,o.alt=item.name,createOrderButton(item.id,t,e[n],r,item.price),specificPageContainer.appendChild(t)}}else{clearBtn.style.display="none";let e=document.createElement("p");e.textContent="Your order is empty",specificPageContainer.appendChild(e)}}function createOrderButton(e,t,n,i,a){let r=document.createElement("div"),o=document.createElement("span"),l=document.createElement("input"),d=document.createElement("span");if(o.textContent="-",o.addEventListener("click",()=>{if("1"!=o.nextElementSibling.value&&(o.nextElementSibling.value=parseInt(o.nextElementSibling.value)-1,n)){let t=orderToObject(localStorage.order);t[e]-=1,t[e]>1?i.textContent=`${a*t[e]}$ in total. ${a}$ for each.`:i.textContent=a+"$ in total.",localStorage.order=orderToString(t)}}),d.textContent="+",d.addEventListener("click",()=>{if(d.previousElementSibling.value=parseInt(d.previousElementSibling.value)+1,n){let t=orderToObject(localStorage.order);t[e]+=1,t[e]>1?i.textContent=`${a*t[e]}$ in total. ${a}$ for each.`:i.textContent=a+"$ in total.",localStorage.order=orderToString(t)}}),l.type="number",l.value=n||1,l.min=1,l.setAttribute("readonly",""),r.appendChild(o),r.appendChild(l),r.appendChild(d),t.appendChild(r),n){let n=document.createElement("button");n.textContent="Delete",n.addEventListener("click",()=>{let t=orderToObject(localStorage.order);delete t[e],localStorage.order=orderToString(t),n.parentElement.remove()}),t.appendChild(n)}else{let n=document.createElement("button");n.textContent="Order",n.value=e,t.appendChild(n),n.addEventListener("click",()=>{let e=parseInt(n.previousSibling.children[1].value);localStorage.order?localStorage.order+=e>1?","+n.value+"x"+e:","+n.value:e>1?localStorage.setItem("order",`${n.value}x${e}`):localStorage.setItem("order",""+n.value)})}}function orderToString(e){let t="",n=Object.entries(e);return n.forEach(e=>{n.indexOf(e)===n.length-1?t+=e[0]+"x"+e[1]:t+=e[0]+"x"+e[1]+","}),t}function orderToObject(e){let t=e.split(",");t.sort();let n=null,i=0,a={};for(let e=0;e<t.length;e++)t[e].includes(n)?t[e].includes("x")?i+=parseInt(t[e].slice(t[e].indexOf("x")+1)):i++:t[e].includes("x")?(i>0&&(a[n]=i),n=t[e].slice(0,4),i=parseInt(t[e].slice(t[e].indexOf("x")+1))):(i>0&&(a[n]=i),n=t[e],i=1);return i>0&&(a[n]=i),a}function clearOrder(){for(;specificPageContainer.firstChild;)specificPageContainer.firstChild.remove(),localStorage.clear();clearBtn.style.display="none";let e=document.createElement("p");e.textContent="Your order is empty",specificPageContainer.appendChild(e)}clearBtn&&clearBtn.addEventListener("click",clearOrder),obj();