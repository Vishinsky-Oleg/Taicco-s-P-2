const mainHeader=document.querySelector(".main-header"),specificPageContainer=document.querySelector(".specific-items"),mainPageContainer=document.querySelector(".specialities-container"),clearBtn=document.querySelector(".clear-order");clearBtn&&clearBtn.addEventListener("click",clearOrder),async function(){if(mainHeader){let e=await fetch("./dist/json/items.json"),t=await e.json();if("italian specialities"===mainHeader.textContent.toLowerCase())for(item of t)if("1111"===item.id||"1112"===item.id||"1113"===item.id||"1114"===item.id){let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("h4"),i=document.createElement("p"),r=document.createElement("h6"),o=document.createElement("img");t.appendChild(o),n.appendChild(a),n.appendChild(i),n.appendChild(r),e.appendChild(n),e.appendChild(t),a.textContent=item.name,i.textContent=item.aboutMini,r.textContent=item.price,o.src="./dist/image/"+item.imagePath,o.alt=item.name,createOrderButton(item.id,n),mainPageContainer.appendChild(e)}if("main dishes"===mainHeader.textContent.toLowerCase()||"salad"===mainHeader.textContent.toLowerCase()||"drinks"===mainHeader.textContent.toLowerCase()){let e,n=1;for(item of(e=mainHeader.textContent.includes(" ")?mainHeader.textContent.slice(0,mainHeader.textContent.indexOf(" ")):mainHeader.textContent,t))if(item.type===e.toLowerCase()){++n;let e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div"),i=document.createElement("h4"),r=document.createElement("p"),o=document.createElement("h6"),l=document.createElement("img");t.appendChild(l),a.appendChild(i),a.appendChild(r),a.appendChild(o),n%2==0?(e.appendChild(a),e.appendChild(t)):(e.appendChild(t),e.appendChild(a)),i.textContent=item.name,r.textContent=item.about,o.textContent=item.price,l.src="./dist/image/"+item.imagePath,l.alt=item.name,createOrderButton(item.id,a),specificPageContainer.appendChild(e)}n=1}if("your order"===mainHeader.textContent.toLowerCase())if(localStorage.order){let e=orderToObject(localStorage.order);for(let n in e)for(item of t)if(item.id===n){let t=document.createElement("div"),a=document.createElement("div"),i=document.createElement("h4"),r=document.createElement("p"),o=document.createElement("h6"),l=document.createElement("img");t.appendChild(l),a.appendChild(t),a.appendChild(i),a.appendChild(r),a.appendChild(o),o.classList.add("item-price"),i.textContent=item.name,r.textContent=item.aboutMini,e[n]>1?o.textContent=`${(item.price*e[n]).toFixed(2)}$ in total. ${item.price}$ for each.`:o.textContent=item.price+"$ in total.",l.src="./dist/image/"+item.imagePath,l.alt=item.name,createOrderButton(item.id,a,e[n],o,item.price),specificPageContainer.appendChild(a)}let n=document.createElement("h2");n.classList.add("order-total"),specificPageContainer.appendChild(n),getOrderTotal(),createFormElements(specificPageContainer)}else{clearBtn.style.display="none";let e=document.createElement("p");e.textContent="Your order is empty",specificPageContainer.appendChild(e)}}}();let total=0;function createFormElements(e){let t=document.createElement("form"),n=document.createElement("label"),a=document.createElement("input"),i=document.createElement("label"),r=document.createElement("input"),o=document.createElement("label"),l=document.createElement("input"),d=document.createElement("button");t.action="#",t.addEventListener("submit",e=>{e.preventDefault();let t={};t.ids=orderToObject(localStorage.order),t.name=a.value,t.phone=r.value,""!==l.textContent&&(t.email=l.value),t.timestamp=(new Date).toLocaleString(),t.total=total+"$"}),n.setAttribute("for","name"),n.textContent="Your name (2-15 symbols)",a.type="text",a.id="name",a.name="name",a.setAttribute("required",""),a.minLength=2,a.maxLength=15,a.placeholder="Your name 2-15 chars.",i.setAttribute("for","phone"),i.textContent="Your phone number",r.type="tel",r.id="phone",r.name="phone",r.setAttribute("required",""),r.placeholder="+7 (___) ___-____",r.pattern="\\+7\\s\\([0-9]{3}\\)\\s[0-9]{3}-[0-9]{4}",r.dataset.slots="_";const c=r.getAttribute("placeholder"),m=new Set(r.dataset.slots||"_"),p=(x=0,Array.from(c,(e,t)=>m.has(e)?x=t+1:x)),s=[...c].findIndex(e=>m.has(e)),u=new RegExp(r.dataset.accept||"\\d","g"),C=e=>(e=e.match(u)||[],Array.from(c,t=>(e[0]===t||m.has(t))&&e.shift()||t)),h=()=>{const[e,t]=[r.selectionStart,r.selectionEnd].map(e=>(e=C(r.value.slice(0,e)).findIndex(e=>m.has(e)))<0?p[p.length-1]:f?p[e-1]||s:e);r.value=C(r.value).join``,r.setSelectionRange(e,t),f=!1};var x;let f=!1;r.addEventListener("keydown",e=>f="Backspace"===e.key),r.addEventListener("input",h),r.addEventListener("focus",h),r.addEventListener("blur",()=>r.value===c&&(r.value="")),o.setAttribute("for","email"),o.textContent="Your email (Optional)",l.type="email",l.id="email",l.name="email",l.size=30,d.textContent="Make order",d.type="submit",d.value="submit",t.appendChild(n),t.appendChild(a),t.appendChild(i),t.appendChild(r),t.appendChild(o),t.appendChild(l),t.appendChild(d),e.appendChild(t)}function getOrderTotal(){total=0;let e=document.querySelector(".order-total");document.querySelectorAll(".item-price").forEach(e=>{total+=parseFloat(e.textContent.slice(0,e.textContent.indexOf("$")))}),e.textContent=`Total order is ${total.toFixed(2)}$`}function createOrderButton(e,t,n,a,i){let r=document.createElement("div"),o=document.createElement("span"),l=document.createElement("input"),d=document.createElement("span");if(o.textContent="-",o.addEventListener("click",()=>{if("1"!=o.nextElementSibling.value&&(o.nextElementSibling.value=parseInt(o.nextElementSibling.value)-1,n)){let t=orderToObject(localStorage.order);t[e]-=1,t[e]>1?a.textContent=`${(i*t[e]).toFixed(2)}$ in total. ${i}$ for each.`:a.textContent=i+"$ in total.",getOrderTotal(),localStorage.order=orderToString(t)}}),d.textContent="+",d.addEventListener("click",()=>{if(d.previousElementSibling.value=parseInt(d.previousElementSibling.value)+1,n){let t=orderToObject(localStorage.order);t[e]+=1,t[e]>1?a.textContent=`${(i*t[e]).toFixed(2)}$ in total. ${i}$ for each.`:a.textContent=i+"$ in total.",getOrderTotal(),localStorage.order=orderToString(t)}}),l.type="number",l.value=n||1,l.min=1,l.setAttribute("readonly",""),r.appendChild(o),r.appendChild(l),r.appendChild(d),t.appendChild(r),n){let n=document.createElement("button");n.textContent="Delete",n.addEventListener("click",()=>{let t=orderToObject(localStorage.order);delete t[e],localStorage.order=orderToString(t),n.parentElement.remove(),getOrderTotal()}),t.appendChild(n)}else{let n=document.createElement("button");n.textContent="Order",n.value=e,t.appendChild(n),n.addEventListener("click",()=>{let e=parseInt(n.previousSibling.children[1].value);localStorage.order?localStorage.order+=e>1?","+n.value+"x"+e:","+n.value:e>1?localStorage.setItem("order",`${n.value}x${e}`):localStorage.setItem("order",""+n.value)})}}function orderToString(e){let t="",n=Object.entries(e);return n.forEach(e=>{n.indexOf(e)===n.length-1?t+=e[0]+"x"+e[1]:t+=e[0]+"x"+e[1]+","}),t}function orderToObject(e){let t=e.split(",");t.sort();let n=null,a=0,i={};for(let e=0;e<t.length;e++)t[e].includes(n)?t[e].includes("x")?a+=parseInt(t[e].slice(t[e].indexOf("x")+1)):a++:t[e].includes("x")?(a>0&&(i[n]=a),n=t[e].slice(0,4),a=parseInt(t[e].slice(t[e].indexOf("x")+1))):(a>0&&(i[n]=a),n=t[e],a=1);return a>0&&(i[n]=a),i}function clearOrder(){for(;specificPageContainer.firstChild;)specificPageContainer.firstChild.remove(),localStorage.clear();total=0,clearBtn.style.display="none";let e=document.createElement("p");e.textContent="Your order is empty",specificPageContainer.appendChild(e)}